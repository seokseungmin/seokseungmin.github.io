---
title: "대여 횟수가 많은 자동차들의 월별 대여 횟수 구하기"
excerpt: "대여 횟수가 많은 자동차들의 월별 대여 횟수 구하기"

categories: SQL
tags:  SQL

permalink: /categories/대여 횟수가 많은 자동차들의 월별 대여 횟수 구하기/ # url

toc: true
toc_sticky: true

date: 2024-01-15
last_modified_at: 2024-01-15
---

# 대여 횟수가 많은 자동차들의 월별 대여 횟수 구하기

programmers SQL 고득점 kit 연습

### 문제 설명
자동차 대여 회사의 자동차 대여 기록을 담고 있는 `CAR_RENTAL_COMPANY_RENTAL_HISTORY` 테이블이 있습니다. 이 테이블의 구조는 다음과 같습니다:

| Column name | Type    | Nullable |
|-------------|---------|----------|
| HISTORY_ID  | INTEGER | FALSE    |
| CAR_ID      | INTEGER | FALSE    |
| START_DATE  | DATE    | FALSE    |
| END_DATE    | DATE    | FALSE    |

여기서 `HISTORY_ID`, `CAR_ID`, `START_DATE`, `END_DATE`는 각각 자동차 대여 기록 ID, 자동차 ID, 대여 시작일, 대여 종료일을 나타냅니다.

### 문제 요구사항
`CAR_RENTAL_COMPANY_RENTAL_HISTORY` 테이블에서 2022년 8월부터 10월까지의 기간 동안 대여 시작일을 기준으로 총 대여 횟수가 5회 이상인 자동차들에 대해 월별 자동차 ID 별 총 대여 횟수(컬럼명: `RECORDS`)를 출력하는 SQL문을 작성해야 합니다. 결과는 월을 기준으로 오름차순 정렬하고, 같은 월 내에서는 자동차 ID를 기준으로 내림차순 정렬해야 합니다. 특정 월의 총 대여 횟수가 0인 경우에는 결과에서 제외해야 합니다.

### 예시 데이터
예를 들어, `CAR_RENTAL_COMPANY_RENTAL_HISTORY` 테이블에 다음과 같은 데이터가 있다고 가정합니다:

| HISTORY_ID | CAR_ID | START_DATE | END_DATE   |
|------------|--------|------------|------------|
| 1          | 1      | 2022-07-27 | 2022-08-02 |
| 2          | 1      | 2022-08-03 | 2022-08-04 |
| 3          | 2      | 2022-08-05 | 2022-08-05 |
| ...        | ...    | ...        | ...        |
| 14         | 2      | 2022-11-05 | 2022-11-05 |
| 15         | 3      | 2022-11-11 | 2022-11-11 |

### 예상 출력
대여 시작일을 기준으로 총 대여 횟수가 5회 이상인 자동차는 자동차 ID가 1, 2인 자동차입니다. 월 별 자동차 ID별 총 대여 횟수를 구하고 월 오름차순, 자동차 ID 내림차순으로 정렬하면 다음과 같은 결과가 나와야 합니다:

| MONTH | CAR_ID | RECORDS |
|-------|--------|---------|
| 8     | 2      | 2       |
| 8     | 1      | 2       |
| 9     | 2      | 1       |
| 9     | 1      | 3       |
| 10    | 2      | 2       |

```sql
SELECT 
    EXTRACT(MONTH FROM START_DATE) AS MONTH, 
    CAR_ID, 
    COUNT(*) AS RECORDS
FROM 
    CAR_RENTAL_COMPANY_RENTAL_HISTORY
WHERE 
    START_DATE BETWEEN '2022-08-01' AND '2022-10-31'
    AND CAR_ID IN (
        SELECT CAR_ID
        FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
        WHERE START_DATE BETWEEN '2022-08-01' AND '2022-10-31'
        GROUP BY CAR_ID
        HAVING COUNT(*) >= 5
    )
GROUP BY 
    MONTH, CAR_ID
ORDER BY 
    MONTH ASC, CAR_ID DESC;
```
