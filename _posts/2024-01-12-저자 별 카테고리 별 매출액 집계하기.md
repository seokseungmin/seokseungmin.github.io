---
title: "저자 별 카테고리 별 매출액 집계하기"
excerpt: "저자 별 카테고리 별 매출액 집계하기"

categories: SQL
tags:  SQL

permalink: /categories/저자 별 카테고리 별 매출액 집계하기/ # url

toc: true
toc_sticky: true

date: 2024-01-12
last_modified_at: 2024-01-12
---

# 저자 별 카테고리 별 매출액 집계하기

programmers SQL 고득점 kit 연습

## 문제 설명

### 테이블 구조

#### BOOK 테이블

| Column name     | Type        | Nullable | Description  |
|-----------------|-------------|----------|--------------|
| `BOOK_ID`       | INTEGER     | FALSE    | 도서 ID      |
| `CATEGORY`      | VARCHAR(N)  | FALSE    | 카테고리 (경제, 인문, 소설, 생활, 기술) |
| `AUTHOR_ID`     | INTEGER     | FALSE    | 저자 ID      |
| `PRICE`         | INTEGER     | FALSE    | 판매가 (원)  |
| `PUBLISHED_DATE`| DATE        | FALSE    | 출판일       |

#### AUTHOR 테이블

| Column name   | Type        | Nullable | Description  |
|---------------|-------------|----------|--------------|
| `AUTHOR_ID`   | INTEGER     | FALSE    | 저자 ID      |
| `AUTHOR_NAME` | VARCHAR(N)  | FALSE    | 저자명       |

#### BOOK_SALES 테이블

| Column name | Type    | Nullable | Description  |
|-------------|---------|----------|--------------|
| `BOOK_ID`   | INTEGER | FALSE    | 도서 ID      |
| `SALES_DATE`| DATE    | FALSE    | 판매일       |
| `SALES`     | INTEGER | FALSE    | 판매량       |

### 문제

2022년 1월의 도서 판매 데이터를 기준으로 저자 별, 카테고리 별 매출액(`TOTAL_SALES = 판매량 * 판매가`)을 구하여, 저자 ID(`AUTHOR_ID`), 저자명(`AUTHOR_NAME`), 카테고리(`CATEGORY`), 매출액(`SALES`) 리스트를 출력하는 SQL문을 작성해주세요. 결과는 저자 ID를 오름차순으로, 저자 ID가 같다면 카테고리를 내림차순 정렬해주세요.

### 예시 데이터

#### BOOK 테이블 예시

| BOOK_ID | CATEGORY | AUTHOR_ID | PRICE | PUBLISHED_DATE |
|---------|----------|-----------|-------|----------------|
| 1       | 인문     | 1         | 10000 | 2020-01-01     |
| 2       | 경제     | 1         | 9000  | 2021-02-05     |
| 3       | 경제     | 2         | 9000  | 2021-03-11     |

#### AUTHOR 테이블 예시

| AUTHOR_ID | AUTHOR_NAME |
|-----------|-------------|
| 1         | 홍길동       |
| 2         | 김영호       |

#### BOOK_SALES 테이블 예시

| BOOK_ID | SALES_DATE | SALES |
|---------|------------|-------|
| 1       | 2022-01-01 | 2     |
| 2       | 2022-01-02 | 3     |
| 1       | 2022-01-05 | 1     |
| 2       | 2022-01-20 | 5     |
| 2       | 2022-01-21 | 6     |
| 3       | 2022-01-22 | 2     |
| 2       | 2022-02-11 | 3     |

### 결과 예시

#### 집계된 매출액

| AUTHOR_ID | AUTHOR_NAME | CATEGORY | TOTAL_SALES |
|-----------|-------------|----------|-------------|
| 1         | 홍길동       | 인문     | 30000       |
| 1         | 홍길동       | 경제     | 126000      |
| 2         | 김영호       | 경제     | 18000       |

#### 정렬된 결과

| AUTHOR_ID | AUTHOR_NAME | CATEGORY | TOTAL_SALES |
|-----------|-------------|----------|-------------|
| 1         | 홍길동       | 인문     | 30000       |
| 1         | 홍길동       | 경제     | 126000      |
| 2         | 김영호       | 경제     | 18000       |

```sql
SELECT 
    AUTHOR.AUTHOR_ID, 
    AUTHOR.AUTHOR_NAME, 
    BOOK.CATEGORY, 
    SUM(BOOK_SALES.SALES * BOOK.PRICE) AS TOTAL_SALES
FROM 
    BOOK_SALES
JOIN 
    BOOK ON BOOK.BOOK_ID = BOOK_SALES.BOOK_ID
JOIN 
    AUTHOR ON BOOK.AUTHOR_ID = AUTHOR.AUTHOR_ID
WHERE 
    DATE_FORMAT(BOOK_SALES.SALES_DATE, '%Y-%m') = '2022-01'
GROUP BY 
    AUTHOR.AUTHOR_ID, BOOK.CATEGORY
ORDER BY 
    AUTHOR.AUTHOR_ID ASC, BOOK.CATEGORY DESC;
```
