---
title: "고양이와 개는 몇 마리 있을까"
excerpt: "고양이와 개는 몇 마리 있을까"

categories: SQL
tags:  SQL

permalink: /categories/고양이와 개는 몇 마리 있을까/ # url

toc: true
toc_sticky: true

date: 2024-01-19
last_modified_at: 2024-01-19
---

# 년, 월, 성별 별 상품 구매 회원 수 구하기

## 문제 설명

programmers SQL 고득점 kit 연습

### USER_INFO 테이블

어느 의류 쇼핑몰에 가입한 회원 정보를 담은 **USER_INFO** 테이블입니다. 이 테이블의 구조는 다음과 같으며, `USER_ID`, `GENDER`, `AGE`, `JOINED`는 각각 회원 ID, 성별, 나이, 가입일을 나타냅니다.

| Column Name | Type        | Nullable |
|-------------|-------------|----------|
| USER_ID     | INTEGER     | FALSE    |
| GENDER      | TINYINT(1)  | TRUE     |
| AGE         | INTEGER     | TRUE     |
| JOINED      | DATE        | FALSE    |

`GENDER` 컬럼은 비어있거나 0 또는 1의 값을 가지며, 0은 남자, 1은 여자를 나타냅니다.

### ONLINE_SALE 테이블

온라인 상품 판매 정보를 담은 **ONLINE_SALE** 테이블입니다. 이 테이블의 구조는 다음과 같으며, `ONLINE_SALE_ID`, `USER_ID`, `PRODUCT_ID`, `SALES_AMOUNT`, `SALES_DATE`는 각각 온라인 상품 판매 ID, 회원 ID, 상품 ID, 판매량, 판매일을 나타냅니다.

| Column Name    | Type    | Nullable |
|----------------|---------|----------|
| ONLINE_SALE_ID | INTEGER | FALSE    |
| USER_ID        | INTEGER | FALSE    |
| PRODUCT_ID     | INTEGER | FALSE    |
| SALES_AMOUNT   | INTEGER | FALSE    |
| SALES_DATE     | DATE    | FALSE    |

동일한 날짜, 회원 ID, 상품 ID 조합에 대해서는 하나의 판매 데이터만 존재합니다.

### 문제

**USER_INFO** 테이블과 **ONLINE_SALE** 테이블에서 년, 월, 성별 별로 상품을 구매한 회원수를 집계하는 SQL문을 작성해주세요. 결과는 년, 월, 성별을 기준으로 오름차순 정렬하며, 성별 정보가 없는 경우 결과에서 제외해주세요.

#### 예시

USER_INFO 테이블과 ONLINE_SALE 테이블 예시 데이터를 바탕으로 한 결과 예시입니다.

USER_INFO 테이블 예시 데이터:

| USER_ID | GENDER | AGE | JOINED      |
|---------|--------|-----|-------------|
| 1       | 1      | 26  | 2021-06-01  |
| 2       | NULL   | NULL| 2021-06-25  |
| ...     | ...    | ... | ...         |

ONLINE_SALE 테이블 예시 데이터:

| ONLINE_SALE_ID | USER_ID | PRODUCT_ID | SALES_AMOUNT | SALES_DATE |
|----------------|---------|------------|--------------|------------|
| 1              | 1       | 54         | 1            | 2022-01-01 |
| 2              | 1       | 3          | 2            | 2022-01-25 |
| ...            | ...     | ...        | ...          | ...        |

결과 예시:

| YEAR | MONTH | GENDER | USERS |
|------|-------|--------|-------|
| 2022 | 1     | 0      | 1     |
| 2022 | 1     | 1      | 1     |
| 2022 | 2     | 1      | 2     |

```sql
SELECT YEAR(SALES_DATE) AS YEAR, MONTH(SALES_DATE) AS MONTH, GENDER, 
COUNT(DISTINCT USER_INFO.USER_ID) AS USERS
FROM USER_INFO JOIN ONLINE_SALE
ON USER_INFO.USER_ID = ONLINE_SALE.USER_ID
WHERE GENDER IS NOT NULL
GROUP BY YEAR, MONTH, GENDER
ORDER BY YEAR, MONTH, GENDER;
```
